<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>LACITY_EXPLORATION 4 | ZONING</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href='css/main.css' rel='stylesheet' type='text/css'>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.19.1/mapbox-gl.js'></script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.19.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.1.0/mapbox-gl-geocoder.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.1.0/mapbox-gl-geocoder.css' type='text/css' />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

</head>
<body>
<div id='map'></div>
<div class='map-overlay top'>
    <div class='map-overlay-inner'>
        <fieldset>
            <label>lacity_exploration 5 | Los Angeles City Zoning Map | V.06</label>
            <p>Click on the legend to filter through the generalized zoning. Click on the map to highlight and identify the zone and all similar zones in the city. Made by Omar Ureta</p>
        </fieldset>
        <fieldset>
            <label>Generalized Zoning</label>
            <div id='swatches'>
            <button style="background:rgba(67,119,44,.5)" onclick='groupchange("openspace",this)'>Open Space</button>
            <button style="background:rgba(196,220,122,.5)" onclick='groupchange("agricultural",this)'>Agricultural</button>
            <button style="background:rgba(246,242,131,.5)" onclick='groupchange("singlefamily",this)'>Single Family Residential</button>
            <button style="background:rgba(252,194,133,.5)" onclick='groupchange("multifamily",this)'>Multifamily Residential</button>
            <button style="background:rgba(241,114,151,.5)" onclick='groupchange("commercial",this)'>Commercial</button>
            <button style="background:rgba(127,164,213,.5)" onclick='groupchange("manufacturing",this)'>Manufacturing</button>
            <button style="background:rgba(159,152,168,.5)" onclick='groupchange("parking",this)'>Parking</button>
            <button style="background:rgba(108,171,152,.5)" onclick='groupchange("publicfacility",this)'>Public Facilities</button>
            </div>
        </fieldset>
    </div>
</div>
<div class='legend-overlay'>
    <div class='legend-overlay-inner'>
    <div id='infobox'></div>    
    </div>
    </div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiY3J1emluNzN2dyIsImEiOiJjaW80MHJvNzgwMWcwdmFrams0OHAxaWozIn0.6TXveIiYaYPFdf8QTO6Ssw';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'js/style.json',
    zoom: 10,
    center: [-118.2621, 34.0267],
    hash:true
});

map.addControl(new mapboxgl.Geocoder({
    position:'top-right',
    proximity:[-118.2621, 34.0267],
    placeholder:"Search by Address"
}));
map.dragRotate.disable();
map.touchZoomRotate.disableRotation();

// When a click event occurs near a marker icon, open a popup at the location of
// the feature, with description HTML from its properties.
var prevpaintlayer = 'RE15_303';
map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, {});
    var srcfeature = map.querySourceFeatures("lacity_zoning")
    if (!features.length) {
        return;
    }
    
    var feature = features[0];
    console.log(feature);
    if (feature.layer['source-layer']==='lacity_zoning'){
        map.setPaintProperty(prevpaintlayer,'fill-opacity',.5);
        map.setPaintProperty(prevpaintlayer,'fill-antialias',false);
        
        document.getElementById('infobox').innerHTML = '<h1>ZONE: '+feature.properties.ZONE_CMPLT+'</h1>'
    var popup = new mapboxgl.Popup()
        .setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.ZONE_CMPLT)
        .addTo(map);
        
        map.setPaintProperty(feature.layer.id,'fill-opacity',1);
        map.setPaintProperty(feature.layer.id,'fill-antialias',true)
        map.setPaintProperty(feature.layer.id,'fill-outline-color','#a4a4a4')
        prevpaintlayer = feature.layer.id;
}
});

// Use the same approach as above to indicate that the symbols are clickable
// by changing the cursor style to 'pointer'.
map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, {});
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
});

var stylelog;
$.getJSON('js/style.json', function(json) {
  stylelog = json;
});
    
    
var groupchange = function(groupname,e){
    var groupindex;
    
    //Finds the group index that matches the group label of the style
    $.each(stylelog.metadata['mapbox:groups'], function(index,value){
    if (value.name===groupname){
        groupindex=index;
    }
    });
    //Finds the layer within the group index to turn off/on the layer
    $.each(stylelog.layers, function(index,value){
        if (value.metadata != null){            
            if (value.metadata['mapbox:group']===groupindex){
                var visibility = map.getLayoutProperty(value.id, 'visibility');
                if (visibility === 'visible') {
                    map.setLayoutProperty(value.id, 'visibility', 'none');
                    e.className = 'active'
                } else {
                    e.className = '';
                    map.setLayoutProperty(value.id, 'visibility', 'visible');
                }
            }
        }
    });
}
</script>

</body>
</html>
